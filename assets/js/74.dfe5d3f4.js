(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{538:function(t,s,n){"use strict";n.r(s);var a=n(2),e=function(t){t.options.__data__block__={flowchart_382ee165:"s=>start: 开始\ncond1=>condition: queueMacrotask 非空？\ncond2=>condition: queueMicrotask 非空？\nop1=>operation: 取出队头的 macrotask 并执行\nop2=>operation: 依次执行完所有的 microtask\nop3=>operation: 渲染\nop4=>operation: 回到第二步\nop5=>operation: 休眠\ne=>end: 结束\n\ns->cond1\nop1->cond2\ncond1(yes)->op1->cond2\ncond1(no)->op5\ncond2(yes)->op2->op3\ncond2(no)->op3\n\nop3->op4"}},o=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("事件循环中的任务划分：")]),t._v(" "),n("ul",[n("li",[t._v("macro-task(宏任务)：整体代码 script，setTimeout，setInterval")]),t._v(" "),n("li",[t._v("micro-task(微任务)：promise 的"),n("code",[t._v(".then\\catch\\finally")]),t._v("中的处理程序（handler），process.nextTick")])]),t._v(" "),n("p",[t._v("其中宏任务的回调函数，会分发到宏任务 Event Queue 中"),n("br"),t._v("\n微任务的回调函数，会分发到微任务 Event Queue 中")]),t._v(" "),n("p",[t._v("事件循环的过程如下：")]),t._v(" "),n("FlowChart",{attrs:{id:"flowchart_382ee165",code:t.$dataBlock.flowchart_382ee165,preset:"vue"}}),n("p",[t._v("来看个例子：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script start"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"script end!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("p",[t._v("在控制台运行后，发现结果是这样的："),n("br"),t._v(" "),n("code",[t._v("script start")]),t._v(" -> "),n("code",[t._v("script end")]),t._v(" -> "),n("code",[t._v("promise1")]),t._v(" -> "),n("code",[t._v("promise2")]),t._v(" ->网页透明度改变-> "),n("code",[t._v("timeout")])]),t._v(" "),n("p",[t._v("可以这么理解：")]),t._v(" "),n("ol",[n("li",[t._v("刚开始，整个 script 的代码可以看成 macro-task 队列中的第一个任务，进入主线程执行；")]),t._v(" "),n("li",[t._v("遇到同步代码"),n("code",[t._v("alert")]),t._v("，直接打印"),n("code",[t._v("script start")]),t._v("；")]),t._v(" "),n("li",[t._v("接着遇到第二个 macro-task，放入 macro-task 队列中；")]),t._v(" "),n("li",[t._v("接着遇到 dom 变更，先不渲染，在本轮事件循环结束之前才渲染；")]),t._v(" "),n("li",[t._v("然后遇到立即 resolve 的 promise1，把它的"),n("code",[t._v("then")]),t._v("中处理程序放入 micro-task 队列中；")]),t._v(" "),n("li",[t._v("接着遇到第二个立即 resolve 的 promise2，操作同上一步。")]),t._v(" "),n("li",[t._v("然后又遇到同步代码"),n("code",[t._v("alert")]),t._v("，直接打印"),n("code",[t._v("script end")])]),t._v(" "),n("li",[t._v("到这里，第一个 macro-task 执行完毕；执行栈来了到 micro-task 队列，一次取出任务执行，先后打印出"),n("code",[t._v("promise1")]),t._v("和"),n("code",[t._v("promsie2")]),t._v(";")]),t._v(" "),n("li",[t._v("所有 micro-task 执行完毕后，开始将 dom 变更渲染出来，所以这时"),n("code",[t._v("document.body.style.opacity = 0.3")]),t._v("真正开始渲染。")]),t._v(" "),n("li",[t._v("到这里已经完成了一轮"),n("code",[t._v("event loop")]),t._v("了，回到第 1 步，"),n("code",[t._v("setTimeout")]),t._v("的回调作为第二个 macro-task，被取出并执行打印"),n("code",[t._v("timeout")]),t._v("。")])]),t._v(" "),n("div",{staticClass:"custom-block theorem"},[n("p",{staticClass:"title"}),n("p",[t._v("参考原文："),n("br"),t._v(" "),n("a",{attrs:{href:"https://juejin.cn/post/6844903512845860872",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.cn/post/6844903512845860872"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://zh.javascript.info/event-loop",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zh.javascript.info/event-loop"),n("OutboundLink")],1)])])],1)}),[],!1,null,null,null);"function"==typeof e&&e(o);s.default=o.exports}}]);